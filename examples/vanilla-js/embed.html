<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Embedded Superset Dashboard</title>
  <script src="https://unpkg.com/@superset-ui/embedded-sdk"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    #dashboard {
      width: 100% !important;
      height: 100% !important;
      min-height: 800px;
      border: none;
      display: block;
    }
    
    /* Dashboard container with better sizing */
    .dashboard-container {
      width: 100%;
      height: 100%;
      padding: 0;
      box-sizing: border-box;
      background: #f5f5f5;
      position: relative;
    }
    
    /* Force Superset iframe to be full size */
    #dashboard iframe {
      width: 100% !important;
      height: 100% !important;
      min-height: 80vh !important;
      border: none !important;
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      background: #fff;
    }
    
    /* Additional iframe styling for better dashboard display */
    #dashboard iframe[src*="superset"] {
      width: 100% !important;
      height: 100% !important;
      min-height: 80vh !important;
      border: none !important;
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
    }
    
    /* Loading indicator */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      font-size: 18px;
      color: #666;
    }
    
    /* Ensure body takes full height */
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Make dashboard container flex to fill space */
    .dashboard-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
      .dashboard-container {
        padding: 10px;
      }
      
      #dashboard {
        min-height: 600px;
      }
    }
    
    /* Fullscreen option */
    .fullscreen-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .fullscreen-btn:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <button class="fullscreen-btn" onclick="toggleFullscreen()">Fullscreen</button>
  
  <div class="dashboard-container">
    <div id="dashboard">
      <div class="loading">Loading dashboard...</div>
    </div>
  </div>

  <script>
    // Fullscreen functionality
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }
    
    // Update button text based on fullscreen state
    document.addEventListener('fullscreenchange', function() {
      const btn = document.querySelector('.fullscreen-btn');
      if (document.fullscreenElement) {
        btn.textContent = 'Exit Fullscreen';
      } else {
        btn.textContent = 'Fullscreen';
      }
    });
    const SUPERSET_HOST = "https://analytics.paycorp.io"; 
    //const DASHBOARD_ID = "b713fcc3-167a-4961-ac21-2fa7e851b514";
  // const DASHBOARD_ID = "d6c3883e-5338-47b0-9b9c-4a1e84969d24";

   //const DASHBOARD_ID = "cbed086f-d491-4c11-a231-83cdb6af4256";
   const DASHBOARD_ID = "b713fcc3-167a-4961-ac21-2fa7e851b514";



    // fetch guest token from your backend
    async function fetchGuestToken() {
      const response = await fetch("http://localhost:8001/generate-token", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ dashboard: DASHBOARD_ID }),
      });

      if (!response.ok) {
        throw new Error("Failed to fetch token from backend");
      }

      const data = await response.json();
      return data.token; // <-- this matches your backend response
    }

    (async function () {
      try {
        await supersetEmbeddedSdk.embedDashboard({
          id: DASHBOARD_ID,
          supersetDomain: SUPERSET_HOST,
          mountPoint: document.getElementById("dashboard"),
          fetchGuestToken,
          dashboardUiConfig: {
            hideTitle: false,
            hideChartControls: false,
            hideTab: false,
            showCrossFilters: true,
            showRefreshButton: true,
            showDownloadButton: true,
            showFilters: true,
          },
          height: "100%",
          width: "100%",
        });
        
        // Force resize after embedding
        setTimeout(() => {
          const iframe = document.querySelector('#dashboard iframe');
          if (iframe) {
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.minHeight = '80vh';
            iframe.style.border = 'none';
            iframe.style.position = 'absolute';
            iframe.style.top = '0';
            iframe.style.left = '0';
            iframe.style.right = '0';
            iframe.style.bottom = '0';
          }
        }, 1000);
        
      } catch (error) {
        console.error('Failed to embed dashboard:', error);
        document.getElementById('dashboard').innerHTML = 
          '<div style="padding: 20px; color: red;">Failed to load dashboard: ' + error.message + '</div>';
      }
    })();
  </script>
</body>
</html>
